<!DOCTYPE html>
<html lang="en">
   <head>
      <title>Floppy Bird</title>
      <meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <meta name="author" content="Nebez Briefkani" />
      <meta name="description" content="play floppy bird. a remake of popular game flappy bird built in html/css/js" />
      <meta name="keywords" content="flappybird,flappy,bird,floppybird,floppy,html,html5,css,css3,js,javascript,jquery,github,nebez,briefkani,nebezb,open,source,opensource" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

      <!-- Open Graph tags -->
      <meta property="og:title" content="Floppy Bird" />
      <meta property="og:description" content="play floppy bird. a remake of popular game flappy bird built in html/css/js" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="https://nebezb.com/floppybird/assets/thumb.png" />
      <meta property="og:url" content="https://nebezb.com/floppybird/" />
      <meta property="og:site_name" content="Floppy Bird" />

      <!-- Style sheets -->
      <link href="css/reset.css" rel="stylesheet">
      <link href="css/main.css" rel="stylesheet">
   </head>
   <body>
      
      <div id="player-form">
         <div class="form-wrap">
            <h1>Floppy Bird med Vium!</h1>
            <p class="sub">Scanna, spela, toppa listan. Vinnaren kontaktas efter dagen.</p>

            <div class="field">
               <label for="playerName">Namn</label>
               <input type="text" id="playerName" placeholder="Ditt namn" required>
            </div>

            <div class="field">
               <label for="playerPhone">Telefon</label>
               <input type="tel" id="playerPhone" placeholder="0701234567" required inputmode="tel" pattern="^[0-9+ \-]{7,20}$">
            </div>

            <button class="btn" type="button" onclick="startGameWithForm()">Starta spelet</button>
            <p class="tiny">Vi sparar endast namn, telefon och poäng för att kontakta vinnaren.</p>
         </div>
      </div>
      <div id="gamecontainer" style="display:none;">
         <div id="gamescreen">
            <div id="sky" class="animated">
               <div id="flyarea">
                  <div id="ceiling" class="animated"></div>
                  <!-- This is the flying and pipe area container -->
                  <div id="player" class="bird animated"></div>

                  <div id="bigscore"></div>

                  <div id="splash"></div>

                  <div id="scoreboard">
                     <div id="medal"></div>
                     <div id="currentscore"></div>
                     <div id="highscore"></div>
                     <div id="replay"><img src="assets/replay.png" alt="replay"></div>
                  </div>

                  <!-- Pipes go here! -->
               </div>
            </div>
            <div id="land" class="animated"><div id="debug"></div></div>
         </div>
      </div>
      <div id="footer">
         <a href="https://www.dotgears.com/">original game/concept/art by dong nguyen</a>
         <a href="https://nebezb.com/">recreated by nebez briefkani</a>
         <a href="https://github.com/nebez/floppybird/">view github project</a>
      </div>
      <div class="boundingbox" id="playerbox"></div>
      <div class="boundingbox" id="pipebox"></div>

      <script src="js/jquery.min.js"></script>
      <script src="js/jquery.transit.min.js"></script>
      <script src="js/buzz.min.js"></script>
      <script src="js/main.js"></script>

      <script>
      function inIframe() {
          try {
              return window.self !== window.top;
          } catch (e) {
              return true;
          }
      }
      if (!inIframe() && window.location.hostname == 'nebezb.com') {
         window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
         ga('create', 'UA-48047334-1', 'auto');
         ga('send', 'pageview');
      }
      </script>
      <script async src='https://www.google-analytics.com/analytics.js'></script>
      <script>
         window.formActive = true;
         let playerName = "";
         let playerPhone = "";

         function stopEv(e){ e.stopPropagation(); }
         ['click','mousedown','touchstart','keydown'].forEach(ev => {
            document.getElementById('player-form').addEventListener(ev, stopEv, { passive:false });
         });

         // körs när man trycker "Starta spelet"
         function startGameWithForm() {
            playerName = document.getElementById("playerName").value;
            playerPhone = document.getElementById("playerPhone").value;

            if (!playerName || !playerPhone) {
               alert("Fyll i både namn och telefonnummer!");
               return;
            }

            document.getElementById("player-form").style.display = "none";
            document.getElementById("gamecontainer").style.display = "block";

            // nu tillåts klick i spelet
            window.formActive = false;

            // nu kör vi spelets riktiga startGame (från main.js)
            //startGame();
         }

         // när spelet är slut, kalla denna (lägg in i main.js gameOver-funktionen)
         function logScore(finalScore) {
            const name = document.getElementById("playerName").value;
            const phone = document.getElementById("playerPhone").value;

            fetch("https://script.google.com/macros/s/AKfycbzwr_ltVGA8qHmZiOeTI17zdtwUIioxS6I3tE8DJDIqD3POAxHRyY4KFj1BfJy2UAmU/exec", {
               method: "POST",
               contentType: "application/json",
               body: JSON.stringify({
                  name: name,
                  phone: phone,
                  score: finalScore
               })
            }).then(() => {
               console.log("Score skickat:", finalScore);
            });
         }


      </script>

   </body>
</html>
